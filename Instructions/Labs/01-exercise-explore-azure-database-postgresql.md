---
lab:
  title: Azure Database for PostgreSQL について調べる
  module: Explore PostgreSQL architecture
---

# Azure Database for PostgreSQL について調べる

この演習では、Azure Database for PostgreSQL フレキシブル サーバーを作成し、バックアップ保持期間を構成します。

## 開始する前に

この演習を完了するには、自分の Azure サブスクリプションが必要です。 Azure サブスクリプションをお持ちでない場合は、[Azure 無料試用版](https://azure.microsoft.com/free)を作成できます。

### リソース グループを作成します

1. Web ブラウザーで、[Azure portal](https://portal.azure.com) に移動します。 所有者または共同作成者のアカウントを使用してサインインします。
2. [Azure サービス] で、**[リソース グループ]**、**[+ 作成]** の順に選択します。
3. 正しいサブスクリプションが表示されていることを確認し、[リソース グループ名] に「**rg-PostgreSQL_Flexi**」と入力します。 **リージョン**を選びます。
4. **[確認と作成]** を選択します。 **[作成]** を選択します。

### Azure Database for PostgreSQL フレキシブル サーバーを作成する

1. [Azure サービス] で、**[+ リソースの作成]** を選択します。
    1. **[マーケットプレースの検索]** で「**`azure database for postgresql flexible server`**」と入力し、**[Azure Database for PostgreSQL フレキシブル サーバー]** を選択して、**[作成]** をクリックします。
1. フレキシブル サーバーの **[基本]** タブで、各フィールドに次のように入力します。
    1. [サブスクリプション] - お使いのサブスクリプション。
    1. [リソース グループ] - **rg-PostgreSQL_Flexi**。
    1. [サーバー名] - **psql-postgresql-fx9999** (サーバー名はグローバルに一意である必要があるため、9999 を 4 つのランダムな数字に置き換えてください)。
    1. [リージョン] - リソース グループと同じリージョンを選択します。
    1. [PostgreSQL バージョン] - [16] を選択します。
    1. [ワークロードの種類] - **開発**。
    1. [コンピューティングとストレージ] - **バースト可能、B1ms**。 **[サーバーの構成]** を選択し、構成オプションを確認します。 何も変更せずに、右隅のブレードを閉じます。
    1. [可用性ゾーン] - 優先設定なし。
    1. [高可用性] - 無効。
    1. [認証方法] - **PostgreSQL の認証のみ**
    1. **[管理者ユーザー名]** に「**`demo`**」と入力します。
    1. **[パスワード]** に適度に複雑なパスワードを入力します。
    1. **[次: ネットワーク >]** を選択します。
1. フレキシブル サーバーの **[ネットワーク]** タブで、各フィールドに次のように入力します。
    1. [接続方法]: (o) パブリック アクセス (許可された IP アドレス) とプライベート エンドポイント
    1. [パブリック アクセス] で、**[パブリック IP アドレスを使用したインターネット経由のこのリソースへのパブリック アクセスを許可する]** を選択します。
    1. [ファイアウォール規則] で、**[+ 現在のクライアント IP アドレスを追加する]** を選択して、現在の IP アドレスをファイアウォール規則として追加します。 必要に応じて、このファイアウォール規則に意味のある名前を付けることができます。
1. **[確認と作成]** を選択します。 設定を確認したあと、**[作成]** を選択して、Azure Database for PostgreSQL フレキシブル サーバーを作成します。 デプロイが完了したら、**[リソースに移動]** を選択して次の手順に備えます。

## サーバー パラメーターを調べる

1. **[設定]** で、**[サーバー パラメーター]** を選択します。
1. **[検索して項目をフィルター処理...]** ボックスに「**`connections`**」と入力します。 接続に関連するサーバー パラメーターが表示されます。 **max_connections** の値をメモします。 変更は加えないでください。
1. 左側のメニューから **[概要]** を選択して、**[サーバー パラメーター]** を終了します。

## バックアップ保持期間を変更する

1. **[概要]** ブレードに移動し、**[設定]** で **[コンピューティングとストレージ]** を選択します。 このセクションには、現在のコンピューティング レベルとそれをアップグレードするためのオプションが表示されます。 また、プロビジョニング済みのストレージ容量とストレージを増加するためのオプションも表示されます。
1. **バックアップ**の下に、バックアップ保持期間の日数が表示されます。 スライダー バーを使用して、バックアップ保持期間を 14 日に変更します。 **[保存]** を選択して変更を保存します。
1. この演習を完了したら、 **[概要]** ブレードに移動し、サーバーを停止する **[停止]** をクリックします。
    1. サーバーが停止状態の間は課金されませんが、サーバーを削除していない場合は 7 日以内にサーバーが再起動されることに注意してください。

## オプションの演習 - 高可用性サーバーを構成する

1. [Azure サービス] で、**[+ リソースの作成]** を選択します。
    1. **[Marketplace を検索]** で「**`azure database for postgresql flexible server`**」と入力し、**[Azure Database for PostgreSQL フレキシブル サーバー]** を選択して、**[作成]** をクリックします。
1. フレキシブル サーバーの **[基本]** タブで、各フィールドに次のように入力します。
    1. [サブスクリプション] - お使いのサブスクリプション。
    1. [リソース グループ] - **rg-PostgreSQL_Flexi**。
    1. [サーバー名] - **psql-postgresql-fx8888** (サーバー名はグローバルに一意である必要があるため、8888 をランダムな数字に置き換えてください)。
    1. [リージョン] - リソース グループと同じリージョンを選択します。
    1. [PostgreSQL バージョン] - [16] を選択します。
    1. [ワークロードの種類] - **運用 (小規模/中規模)​**
    1. [コンピューティングとストレージ] - **[汎用]** のままにします。
    1. [可用性ゾーン] - これは [優先設定なし] のままにしておくことができます。そして、Azure によって、プライマリ サーバーとセカンダリ サーバーの可用性ゾーンが自動的に選択されます。 または、アプリケーションと共存させる可用性ゾーンを指定します。
    1. [高可用性を有効にする] - オンにします。 このオプションをオンにする場合は、見積もりコストに注意してください。
    1. [高可用性モード] - **[ゾーン冗長 - スタンバイ サーバーはプライマリ サーバーと同じリージョンの別のゾーン内で常に使用できます]** を選択します
    1. [認証方法] - **PostgreSQL の認証のみ**
    1. **[管理者ユーザー名]** に、「**demo**」と入力します。
    1. **[パスワード]** に適度に複雑なパスワードを入力します。
    1. **[次: ネットワーク >]** を選択します。
1. フレキシブル サーバーの **[ネットワーク]** タブで、各フィールドに次のように入力します。
    1. [接続方法]: (o) パブリック アクセス (許可された IP アドレス) とプライベート エンドポイント
    1. [パブリック アクセス] で、**[パブリック IP アドレスを使用したインターネット経由のこのリソースへのパブリック アクセスを許可する]** を選択します。
    1. [ファイアウォール規則] で、**[+ 現在のクライアント IP アドレスを追加する]** を選択して、現在の IP アドレスをファイアウォール規則として追加します。 必要に応じて、このファイアウォール規則に意味のある名前を付けることができます。
1. **[確認と作成]** を選択します。 設定を確認し、**[作成]** を選択して、Azure Database for PostgreSQL フレキシブル サーバーを作成します。 デプロイが完了したら、**[リソースに移動]** を選択して次の手順に備えます。

### 新しいサーバーを検査する

1. **[設定]** で、**[高可用性]** を選択します。 高可用性が有効で、プライマリ可用性ゾーンが [ゾーン 1] になっているはずです。
    1. スタンバイ可用性ゾーンは自動的に割り当てられ、プライマリ可用性ゾーンとは異なり通常は [ゾーン 2] です。

### フェールオーバーを強制する

1. **[高可用性]** ブレードで、上部のメニューから **[強制フェールオーバー]** を選択します。 メッセージが表示されたら、**[OK]** を選択します。
1. フェールオーバー プロセスが開始されます。 フェールオーバー操作が正常に完了すると、メッセージが表示されます。
1. **[高可用性]** ブレードで、プライマリ ゾーンが 2 になり、スタンバイ可用性ゾーンが 1 になっていることがわかります。 最新情報を確認するには、ブラウザーを更新することが必要な場合があります。
1. この演習を完了したら、サーバーを削除してください。

## クリーンアップ

このラボの演習用のサーバーには料金が発生します。 演習が完了したら、リソース グループ **rg-PostgreSQL_Flexi** を削除します。 これにより、このラボ演習でデプロイしたサーバーとその他のリソースが削除されます。
